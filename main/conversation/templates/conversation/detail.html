{% extends 'core/base.html' %}
{% load static %}

{% block title %}Conversation{% endblock  %}


{% block content %}

<div class="container">
    {% include 'core/sidebar.html' with latest_items=latest_items %}
    <div class="conversation-detail">
        <div class="pre-msg">
        <table class="past-conv">
            <h1>Past communication regarding {{ conversation.item_name }}</h1>
            <thead>
                <th style="'width: auto;">Image</th>
                <th>Initiator</th>
                <th>Content</th>
            </thead>
            <tbody>
                {% for message in conversation.messages.all %}
                    <tr>
                        <td>
                            <a href="{% url 'item:detail' conversation.item.id %}"><img src="{{ conversation.item.image.url }}" alt="">
                            </a>
                        </td>
                        <td>
                            {% if message.created_by == request.user %}
                                <a href="{% url 'item:detail' conversation.item.id %}"><p class="blue-text"><strong>{{ message.created_by.username|capfirst }}</strong> @ {{message.created_at|date:"Y-m-d" }}</p></a>
                            {% else %} 
                                <a href="{% url 'item:detail'   conversation.item.id %}"></a><p class="gray-text"><strong>{{ message.created_by.username|capfirst }}</strong> @ {{message.created_at|date:"Y-m-d" }}</p></a>
                            {% endif %}
                        </td>
                        <td>
                            {% if message.created_by == request.user %}
                                <a href="{% url 'item:detail' conversation.item.id %}"></a><p class="blue-text">{{ message.content }}</p></a>
                            {% else %} 
                                <a href="{% url 'item:detail' conversation.item.id %}"><p class="gray-text">{{ message.content }}</p></a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>

        <div class="message-box">
            <p><strong>Enter new message below:</strong></p>
            <!-- {{ message.created_by.username|capfirst }} -->
            <form method="post" action=".">
                {% csrf_token %}
    
                <div class="msg-container">
                    <label for="content" class="form-label"></label><br>
                    <textarea name="content" class="form-textarea"></textarea> 
                </div>
                <button type="submit">Send</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}